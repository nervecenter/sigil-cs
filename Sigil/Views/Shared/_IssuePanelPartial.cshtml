@using Sigil.Models
@using Sigil.ViewModels

@model IssueViewModel

@helper MainMarkup() {


    <div class="panel-body">
        <div class="media">
            <div class="media-object pull-left votebutton-box">
                @if ( !Request.IsAuthenticated ) {
                    <img src="~/Content/Images/notvoted.png" class="voteup" onclick="redirectToLogin()" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                } else if ( Model.userVoted ) {
                    <img src="~/Content/Images/voted.png" class="unvoteup" onclick="unvoteup(this, @Model.IssueId)" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                } else {
                    <img src="~/Content/Images/notvoted.png" class="voteup" onclick="voteup(this, @Model.IssueId)" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                }
                <br />
                <span id="count-@Model.IssueId" class="voteamount">@Model.votes</span>
            </div>
            <div class="media-body">
                <h4 class="media-heading">
                    <a href="/@Model.IssueCategoryVM.OrgVM.OrgURL/@Model.IssueId">@Model.Title</a>
                    @if ( Model.Responded ) { <small><i style="color:red;">Response!</i></small> }
                </h4>
                <p class="pull-left">
                    <img class="issue-panel-icon" src="@*@(Sigil.Controllers.ImageController<Org>.Get_Icon_20( thisIssue.Org ))*@" /><span><a href="/@Model.IssueCategoryVM.OrgVM.OrgURL">@Model.IssueCategoryVM.OrgVM.OrgName</a></span>
                    <span>: @Model.IssueCategoryVM.CategoryName</span>
                    @*<span>in @thisIssue.Topic.topicName</span>*@
                </p>
                <p class="pull-right">
                    Posted @*@Sigil.Controllers.IssueController.TimeSince( thisIssue.CreateTime )*@ 
                    <span>by @Model.IssueUserDisplayName</span>
                </p>
            </div>
        </div>
    </div>
}

@if ( Model.InPanel ) {
    <div class="panel panel-default">
        @MainMarkup()
    </div>
} else {
    @MainMarkup()
}