@using Sigil.Models

@model Tuple<IssuePanelOptions, Issue>

@{
    bool inPanel = Model.Item1.inPanel;
}

@helper MainMarkup() {
bool showOrg = Model.Item1.showOrg;
bool showCat = Model.Item1.showCat;
bool showTopic = Model.Item1.showTopic;
bool showUser = Model.Item1.showUser;
bool userVoted = Model.Item1.userVoted;
Issue thisIssue = Model.Item2;

    <div class="panel-body">
        <div class="media">
            <div class="media-object pull-left votebutton-box">
                @if ( !Request.IsAuthenticated ) {
                    <img src="~/Content/Images/notvoted.png" class="voteup" onclick="redirectToLogin()" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                } else if ( userVoted ) {
                    <img src="~/Content/Images/voted.png" class="unvoteup" onclick="unvoteup(this, @thisIssue.Id)" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                } else {
                    <img src="~/Content/Images/notvoted.png" class="voteup" onclick="voteup(this, @thisIssue.Id)" onmouseover="votehover(this)" onmouseout="voteunhover(this)">
                }
                <br />
                <span id="count-@thisIssue.Id" class="voteamount">@thisIssue.votes</span>
            </div>
            <div class="media-body">
                <h4 class="media-heading">
                    <a href="/@thisIssue.Org.orgURL/@thisIssue.Id">@thisIssue.title</a>
                    @if ( thisIssue.responded ) { <small><i style="color:red;">Response!</i></small> }
                </h4>
                <p class="pull-left">
                    @if ( showOrg ) { <img class="issue-panel-icon" src="@(Sigil.Controllers.ImageController<Org>.Get_Icon_20( thisIssue.Org ))" /><span><a href="/@thisIssue.Org.orgURL">@thisIssue.Org.orgName</a></span> }
                    @if ( showCat ) { <span>: @thisIssue.Category.catName</span> }
                    @if ( showTopic ) { <span>in @thisIssue.Topic.topicName</span> }
                </p>
                <p class="pull-right">
                    Posted @Sigil.Controllers.IssueController.TimeSince( thisIssue.createTime ) 
                    @if ( showUser ) { <span>by @thisIssue.AspNetUser.UserName</span> }
                </p>
            </div>
        </div>
    </div>
}

@if ( inPanel ) {
    <div class="panel panel-default">
        @MainMarkup()
    </div>
} else {
    @MainMarkup()
}